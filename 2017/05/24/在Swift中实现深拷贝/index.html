<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>在Swift中实现深拷贝 | Alexius&#39;s Utopia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="关于数组拷贝的例子首先，先看一个例子。 12345678910111213141516171819202122232425262728struct Teacher &amp;#123;    var name: String    var age: Int&amp;#125;class Student &amp;#123;    var name: String    var age: Int    init(name:">
<meta name="keywords" content="Swift">
<meta property="og:type" content="article">
<meta property="og:title" content="在Swift中实现深拷贝">
<meta property="og:url" content="http://yoursite.com/2017/05/24/在Swift中实现深拷贝/index.html">
<meta property="og:site_name" content="Alexius&#39;s Utopia">
<meta property="og:description" content="关于数组拷贝的例子首先，先看一个例子。 12345678910111213141516171819202122232425262728struct Teacher &amp;#123;    var name: String    var age: Int&amp;#125;class Student &amp;#123;    var name: String    var age: Int    init(name:">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-07-01T05:09:10.933Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="在Swift中实现深拷贝">
<meta name="twitter:description" content="关于数组拷贝的例子首先，先看一个例子。 12345678910111213141516171819202122232425262728struct Teacher &amp;#123;    var name: String    var age: Int&amp;#125;class Student &amp;#123;    var name: String    var age: Int    init(name:">
  
    <link rel="alternate" href="/atom.xml" title="Alexius&#39;s Utopia" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Alexius&#39;s Utopia</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Amusing ourselves to death.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-在Swift中实现深拷贝" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/24/在Swift中实现深拷贝/" class="article-date">
  <time datetime="2017-05-24T03:02:44.000Z" itemprop="datePublished">2017-05-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      在Swift中实现深拷贝
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="关于数组拷贝的例子"><a href="#关于数组拷贝的例子" class="headerlink" title="关于数组拷贝的例子"></a>关于数组拷贝的例子</h3><p>首先，先看一个例子。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> age: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>, age: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.age = age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> teachers = [<span class="type">Teacher</span>(name: <span class="string">"Alex"</span>, age: <span class="number">32</span>)]</span><br><span class="line"><span class="keyword">var</span> students = [<span class="type">Student</span>(name: <span class="string">"Bob"</span>, age: <span class="number">18</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> teachersCopy = teachers</span><br><span class="line"><span class="keyword">var</span> studentsCopy = students</span><br><span class="line"></span><br><span class="line">teachersCopy[<span class="number">0</span>].name = <span class="string">"AlexCopy"</span></span><br><span class="line">studentsCopy[<span class="number">0</span>].name = <span class="string">"BobCopy"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(teachers[<span class="number">0</span>].name, teachersCopy[<span class="number">0</span>].name) <span class="comment">// "Alex AlexCopy"</span></span><br><span class="line"><span class="built_in">print</span>(students[<span class="number">0</span>].name, studentsCopy[<span class="number">0</span>].name) <span class="comment">// "BobCopy BobCopy"</span></span><br></pre></td></tr></table></figure>
<p>为什么会出现上述这种情况呢？根据 Apple 的文档来看：</p>
<blockquote>
<p>Each array has an independent value that includes the values of all of its elements. For simple types such as integers and other structures, this means that when you change a value in one array, the value of that element does not change in any copies of the array.</p>
</blockquote>
<p>简单翻译一下的意思就是，每个数组包括它包含的所有元素都有其独立的值。对于简单类型例如整型和其它结构来说，这意味着当你改变一个数组中的值时，该元素的值在数组的其它副本中的值并不会随之改变。</p>
<blockquote>
<p>If the elements in an array are instances of a class, the semantics are the same, though they might appear different at first. In this case, the values stored in the array are references to objects that live outside the array. If you change a reference to an object in one array, only that array has a reference to the new object. However, if two arrays contain references to the same object, you can observe changes to that object’s properties from both arrays. </p>
</blockquote>
<p>但是，如果数组中的元素是类的实例的话，在这种情况下，数组中存储的只是存在于数组外部的对象的引用。如果在一个数组中更改对对象的引用，则只有该数组具有对新对象的引用。 但是，如果两个数组包含对同一对象的引用，则可以从两个数组中观察到对该对象属性的更改。</p>
<p>回到我们的例子，因为 <code>Teacher</code>是一个结构体，属于简单数据类型，当存放它的数组被 copy 的时候，同时复制了数组中所有元素的值。所以，更改<code>teachersCopy</code>中的元素的时候原数组不受影响。</p>
<p>而<code>Student</code>是一个<code>class</code>，当存放<code>Student</code>的数组被复制的时候，复制的其实是对象的引用，因此对<code>studentsCopy</code>中的元素更改值的时候，两个数组中的元素都被更改。</p>
<h3 id="数组的深拷贝"><a href="#数组的深拷贝" class="headerlink" title="数组的深拷贝"></a>数组的深拷贝</h3><p>那么如何实现包含类实例的深拷贝呢？众所周知，在<code>Objective-C</code>中自定义类要实现copy需要遵循<code>NSCopying</code>协议。在 Swift 中也是一样的做法。</p>
<p>首先，定义一个<code>Coping</code>协议。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Copying</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">(original: <span class="keyword">Self</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Copying</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">copy</span><span class="params">()</span></span> -&gt; <span class="type">Self</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Self</span>.<span class="keyword">init</span>(original: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，让我们的自定义类遵循这个协议，并实现相应的方法。同时，在 copy 数组的时候也要改变方式。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>: <span class="title">Copying</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(original: <span class="type">Student</span>) &#123;</span><br><span class="line">        name = original.name</span><br><span class="line">        age = original.age</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> studentsCopy = [<span class="type">Student</span>]()</span><br><span class="line"><span class="keyword">for</span> student <span class="keyword">in</span> students &#123;</span><br><span class="line">    <span class="keyword">let</span> copiedStudent = student.copy()</span><br><span class="line">    studentsCopy.append(copiedStudent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，再修改<code>studentsCopy</code>中的内容，<code>students</code>就不会再随之改变了，数组的深拷贝也就实现了。</p>
<p>当然，还有更精简一些的写法。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> <span class="title">where</span> <span class="title">Element</span>: <span class="title">Copying</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">copy</span><span class="params">()</span></span> -&gt; <span class="type">Array</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> copiedArray = <span class="type">Array</span>&lt;<span class="type">Element</span>&gt;()</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            copiedArray.append(element.copy)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> copiedArray</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> studentsCopy = students.copy()</span><br></pre></td></tr></table></figure>
<p>That’s done.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/24/在Swift中实现深拷贝/" data-id="ckls1u0re0006f0xrtlt8u30t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift/">Swift</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/08/24/iOS中绘制SVG（一）：SVG文件的解析/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          iOS中绘制SVG（一）：SVG文件的解析
        
      </div>
    </a>
  
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/MVVM/">MVVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Objective-C/">Objective-C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVG/">SVG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/">Swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/二维码/">二维码</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/MVVM/" style="font-size: 10px;">MVVM</a> <a href="/tags/Objective-C/" style="font-size: 10px;">Objective-C</a> <a href="/tags/SVG/" style="font-size: 15px;">SVG</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/二维码/" style="font-size: 10px;">二维码</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/13/在Swift中实现MVVM/">【翻译】在Swift中实现MVVM</a>
          </li>
        
          <li>
            <a href="/2020/02/12/SwiftUI中的Property-Wrapper-01/">SwiftUI中的Property Wrapper #01</a>
          </li>
        
          <li>
            <a href="/2017/09/16/iOS二维码的识别/">iOS中二维码的识别</a>
          </li>
        
          <li>
            <a href="/2017/08/26/iOS中绘制SVG（二）：path命令的绘制/">iOS中绘制SVG（二）：path命令的绘制</a>
          </li>
        
          <li>
            <a href="/2017/08/24/iOS中绘制SVG（一）：SVG文件的解析/">iOS中绘制SVG（一）：SVG文件的解析</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Alexius<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>